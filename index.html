<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Frohe Weihnachten Lynn</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --green:#0f3d2e;
  --soft:#f7f7f5;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(#ffffff, var(--soft));
  font-family:'Montserrat', sans-serif;
  color:#111;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  overflow:hidden;
}

.container{
  width:100%;
  max-width:520px;
  padding:80px 24px 120px;
}

h1{
  font-family:'Playfair Display', serif;
  font-size:2.6rem;
  margin-bottom:20px;
}

.highlight{ color:var(--green); }

.subtitle{
  font-size:1.05rem;
  margin-bottom:30px;
}

.btn{
  font-size:1.05rem;
  padding:14px 38px;
  background:#fff;
  border:2px solid var(--green);
  color:var(--green);
  border-radius:10px;
  cursor:pointer;
}

.countdownBox{
  display:none;
  font-size:3rem;
  color:var(--green);
  margin-top:20px;
}

video{
  display:none;
  width:100%;
  margin-top:30px;
  border-radius:12px;
}

.reveal{
  display:none;
  margin-top:30px;
  font-size:1.3rem;
  color:var(--green);
}

/* AR Button */
#arBtn{
  display:none;
  opacity:0;
  margin-top:40px;
  transition:opacity .6s ease;
}

/* AR Overlay */
.ar{
  position:fixed;
  inset:0;
  background:#000;
  z-index:9999;
  overflow:hidden;
}
.ar.hidden{ display:none; }

#cameraVideo{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* GIF Layer */
#gifLayer{
  position:absolute;
  inset:0;
  pointer-events:none;
}

.gif{
  position:absolute;
  width:90px;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.4));
}

@keyframes rightToLeft {
  from{ transform:translateX(110vw); }
  to{ transform:translateX(-150px); }
}

.gif.right-to-left{
  bottom:8%;
  animation: rightToLeft 6s linear forwards;
}

.ar-close{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
}
</style>
</head>

<body>

<div class="container">
  <h1>
    Frohe Weihnachten<br>
    <span class="highlight">Liebe Lynn!</span>
  </h1>

  <p class="subtitle">Ein kleiner Countdown ‚Äì dann startet dein Video.</p>

  <button id="playBtn" class="btn">PLAY</button>

  <div id="countdownBox" class="countdownBox">
    <span id="countdownNumber">10</span>
  </div>

  <video id="giftVideo" controls playsinline>
    <source src="lynn.mp4" type="video/mp4" />
  </video>

  <div id="giftReveal" class="reveal">
    Kauf dir was Sch√∂nes üéÅ
  </div>

  <button id="arBtn" class="btn">
    üì∑ AR Erlebnis starten
  </button>
</div>

<!-- AR Overlay -->
<div id="arOverlay" class="ar hidden">
  <video id="cameraVideo" autoplay playsinline muted></video>
  <div id="gifLayer"></div>
  <button id="closeAr" class="btn ar-close">‚úï AR schlie√üen</button>
</div>

<script>
/* ---------------- VIDEO FLOW ---------------- */
const playBtn = document.getElementById('playBtn');
const countdownBox = document.getElementById('countdownBox');
const countdownNumber = document.getElementById('countdownNumber');
const videoEl = document.getElementById('giftVideo');
const revealEl = document.getElementById('giftReveal');
const arBtn = document.getElementById('arBtn');

let timeLeft = 10;

playBtn.addEventListener('click', () => {
  playBtn.style.display = 'none';
  countdownBox.style.display = 'block';

  const timer = setInterval(() => {
    timeLeft--;
    countdownNumber.textContent = timeLeft;

    if(timeLeft <= 0){
      clearInterval(timer);
      countdownBox.style.display = 'none';
      videoEl.style.display = 'block';
      videoEl.play();
    }
  }, 1000);
});

videoEl.addEventListener('ended', () => {
  revealEl.style.display = 'block';
  arBtn.style.display = 'inline-block';
  setTimeout(() => arBtn.style.opacity = 1, 50);
});

/* ---------------- AR + CAMERA + GIFS ---------------- */
const arOverlay = document.getElementById('arOverlay');
const cameraVideo = document.getElementById('cameraVideo');
const closeAr = document.getElementById('closeAr');
const gifLayer = document.getElementById('gifLayer');

let stream = null;
let gifInterval = null;

const gifs = [
  'Random.gif',
  'Random2.gif',
  'Random3.gif',
  'Left.gif',
  'Right.gif',
  'RightToLeft.gif'
];

arBtn.addEventListener('click', async () => {
  arOverlay.classList.remove('hidden');

  try{
    stream = await navigator.mediaDevices.getUserMedia({
      video:{
        facingMode:{ ideal:'environment' }
      },
      audio:false
    });

    cameraVideo.srcObject = stream;
    cameraVideo.muted = true;
    cameraVideo.play().catch(()=>{});

    spawnGif();
    gifInterval = setInterval(spawnGif, 2500);

  }catch(err){
    alert('Kamera konnte nicht gestartet werden');
    console.error(err);
  }
});

closeAr.addEventListener('click', () => {
  arOverlay.classList.add('hidden');
  if(stream){
    stream.getTracks().forEach(t => t.stop());
  }
  clearInterval(gifInterval);
  gifLayer.innerHTML = '';
});

function spawnGif(){
  const file = gifs[Math.floor(Math.random() * gifs.length)];
  const img = document.createElement('img');
  img.src = file;
  img.classList.add('gif');

  if(file.toLowerCase().includes('righttoleft')){
    img.classList.add('right-to-left');
    img.style.left = '0';
    setTimeout(() => img.remove(), 6500);
  }
  else if(file.toLowerCase().includes('left')){
    img.style.left = '6%';
    img.style.top = rand(20,70)+'%';
  }
  else if(file.toLowerCase().includes('right')){
    img.style.right = '6%';
    img.style.top = rand(20,70)+'%';
  }
  else{
    img.style.left = rand(5,80)+'%';
    img.style.top = rand(10,70)+'%';
  }

  gifLayer.appendChild(img);

  if(!file.toLowerCase().includes('righttoleft')){
    setTimeout(() => img.remove(), 3000);
  }
}

function rand(min,max){
  return Math.random()*(max-min)+min;
}
</script>

</body>
</html>
